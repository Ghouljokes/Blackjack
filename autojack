import random
import copy
import time
from dudesrock import Dude
from deck import deck as deck


class Airobot1(Dude):
 
    def place_bet(self, bet: int, to_match: object) -> None:
        self.bet = bet
        if self.bet > to_match.chips:
            self.bet = to_match.chips
        elif self.bet <= 10:
            self.bet = self.chips
        print(f"{self.name} bets {self.bet} chips.")

    def make_choice(self) -> str:
        if self.get_total() in range(9, 12) and self.can_double_down:
            return "4"
        elif self.get_total() < 16:
            return "1"
        elif self.get_total() == 16 and self.can_surrender:
            return "3"
        else:
            return "2"


dealer = Dude(500, "Dealer")
robot1 = Airobot1(100, "robot1")


def play_round() -> None:
    print("NEW ROUND")
    print(f"House chips: {dealer.chips}, robot1 chips: {robot1.chips}")
    robot1.place_bet(robot1.chips//3, dealer)
    for card in deck:
        card.in_deck = True
    dealer.prep_round(deck)
    robot1.prep_round(deck)
    print(f"Dealer's hand: {dealer.hand[0].get_full_name()}, hidden")


    if dealer.get_total() == 21:
        print(f"{dealer.show_hand()}\n Blackjack! Dealer wins {int(1.5 * robot1.bet)} chips.")
        robot1.earns_from(int(-1.5 * robot1.bet), dealer)
        return

    while robot1.get_total() < 21:
        print(robot1.show_hand())
        choice = robot1.make_choice()
        if choice == "1":
            robot1.draw(deck)
            print("Robot1 chooses to hit.")
            robot1.can_surrender, robot1.can_double_down = False, False
        elif choice == "2":
            print("Robot1 chooses to stay.")
            break
        elif choice == "3":
            print(f"Robot1 surrenders and gives up {int(.5 * robot1.bet)} chips.")
            robot1.earns_from(int(-.5 * robot1.bet), dealer)
            return
        else:
            print("Robot1 chooses to double down.")
            robot1.bet *= 2
            robot1.draw(deck)
            break

    print(robot1.show_hand())

    if robot1.get_total() == 21:
        print(f"Blackjack! Robot1 wins {int(1.5 * robot1.bet)} chips.")
        robot1.earns_from(int(1.5 * robot1.bet), dealer)
        return
    if robot1.get_total() > 21:
        print(f"Robot1 overshoots and loses {robot1.bet} chips.")
        robot1.earns_from(-robot1.bet, dealer)
        return

    print(dealer.show_hand())

    dealer.auto_draw(16, deck)

    if dealer.get_total() > 21:
        print(f"House overshot. Robot1 gains {robot1.bet} chips.")
        robot1.earns_from(robot1.bet, dealer)
    elif dealer.get_total() > robot1.get_total():
        print(f"House wins. Robot1 loses {robot1.bet} chips")
        robot1.earns_from(-robot1.bet, dealer)
    elif dealer.get_total() < robot1.get_total():
        print(f"Robot1 wins. Robot1 gains {robot1.bet} chips")
        robot1.earns_from(robot1.bet, dealer)
    else:
        print("Evened out")


while  robot1.chips > 0 and dealer.chips > 0:
    play_round()
if robot1.chips <= 0:
    print("Robot1 lost all their chips")
elif dealer.chips <= 0:
    print("The casino is now bankrupt")